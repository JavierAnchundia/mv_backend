<!doctype html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <title>Mapa Virtual</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
     <style>
         body{
             width: 100%;
             height: 100vh;
         }
         span{
             color: red;
         }
         .ocultar{
             display: none;
             color: red;
         }
         .mostrar{
             display: block;
             color: red;
         }
         #contenedor{
             margin-top: 100px;
             width: 100%;
             height: 100%;
             display: flex;
             flex-direction: column;
             /*justify-content: center;*/
             align-items: center;
         }
     </style>
    </head>
    <body>
        <div id="contenedor">

<!--            {{user}} {{camp}}-->
            <form autocomplete="off">
                <h4>Recuperar Contraseña</h4>
                <div class="form-group">
                      <label class="" for="password">Contraseña</label>
                      <input type="password" class="form-control" id="password">
                      <span id="lengthPassword" class="ocultar">
                          <small>
                              La contraseña debe estar entre 6 y 20 caracteres
                          </small>
                      </span>
                </div>
                <div class="form-group">
                    <label for="confirmarPassword">Confirmar Contraseña</label>
                    <input type="password" class="form-control" id="confirmarPassword">
                    <span id="lengthRepeatPassword" class="ocultar">
                        <small>
                            La contraseña debe estar entre 6 y 20 caracteres
                        </small>
                    </span>
                    <span id="validatePassword" class="ocultar">
                        <small>
                            No coinciden las contraseñas
                        </small>
                    </span>
                </div>
                <button type="button" class="btn btn-primary" id="cambiarPasswd">Aceptar</button>
            </form>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <script>
            $( document ).ready(function() {
                $(document).on('click','#cambiarPasswd', function(){
                    let contrasena = $('#password').val();
                    let repeatContrasena = $('#confirmarPassword').val();
                    console.log(contrasena, repeatContrasena);
                    verificarContrasena();
                });
            });
            function verificarContrasena(){
                console.log('verificar')
                let contrasena = $('#password').val();
                let repeatContrasena = $('#confirmarPassword').val();

                if(contrasena.length < 6 || contrasena.length >20){
                    $('#lengthPassword').removeClass('ocultar').addClass('mostrar');
                }
                else if(contrasena.length >= 6 && contrasena.length <=20 ){
                    $('#lengthPassword').removeClass('mostrar').addClass('ocultar');
                }

                if(repeatContrasena.length < 6 || repeatContrasena.length >20 ){
                    $('#lengthRepeatPassword').removeClass('ocultar').addClass('mostrar');
                }else if(repeatContrasena.length >= 6 && repeatContrasena.length <=20 ){
                    $('#lengthRepeatPassword').removeClass('mostrar').addClass('ocultar');
                }

                if(contrasena != repeatContrasena){
                    $('#validatePassword').removeClass('ocultar').addClass('mostrar');
                }
                else if(contrasena == repeatContrasena){
                    $('#validatePassword').removeClass('mostrar').addClass('ocultar');
                }

                if((contrasena == repeatContrasena) && (contrasena.length >= 6 && contrasena.length <=20) && (repeatContrasena.length >= 6 && repeatContrasena.length <=20)){
                    let url = window.location.href;
                    let arregloUrl = url.split("/");
                    console.log(arregloUrl);
                    let id_user = arregloUrl[5];
                    let token = arregloUrl[6];
                    let datos = {
                        "id_user" : id_user,
                        "password" : contrasena,
                        "token": token
                    }
                    postUpdatePassword(datos,  id_user, token);
                }
            }
            function postUpdatePassword(datos, id_user){
                $.ajax({
                    type: "PUT",
                    contentType: 'application/json',
                    url: "http://127.0.0.1:8000/api/actualizar_contrasena/"+id_user+"/",
                    data: JSON.stringify(datos),
                    success: function(result) {
                        if (result.status == "success") {
                            console.log(result.status);
                        }
                    },
                    error : function(e) {
                        console.log("error")
                    }
                });
            }
        </script>
    </body>
</html>
